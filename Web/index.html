<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three.js with TIF</title>
    <!-- 引入 Three.js 庫 -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.142.0/build/three.min.js"></script>
    <!-- 引入 tiff.js 庫 -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/tiff@6.1.0/lib/index.min.js"></script> -->
    <script src="./js/tiff.min.js"></script>
</head>

<body>
    <!-- 創建一個容器來顯示三維場景 -->
    <div id="container"></div>

    <script>
        // 設置場景
        var scene = new THREE.Scene();

        // 設置相機
        var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;

        // 設置渲染器
        var renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('container').appendChild(renderer.domElement);

        // 加載並解析 TIF 圖像
        fetch('./Dataset/cell_yxz_007_009_014.tif')
            .then(response => response.arrayBuffer())
            .then(buffer => {
                var tiff = new Tiff({ buffer: buffer });
                var canvas = tiff.toCanvas();
                var texture = new THREE.CanvasTexture(canvas);

                // 創建一個平面並應用 TIF 材質
                var geometry = new THREE.PlaneGeometry(5, 5);
                var material = new THREE.MeshBasicMaterial({ map: texture });
                var plane = new THREE.Mesh(geometry, material);
                scene.add(plane);

                // 動畫函數
                function animate() {
                    requestAnimationFrame(animate);

                    // 旋轉平面
                    plane.rotation.x += 0.01;
                    plane.rotation.y += 0.01;

                    renderer.render(scene, camera);
                }

                animate();
            })
            .catch(error => console.error('Error loading TIF file:', error));
    </script>
</body>

</html>